<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Drachtio-fsmrf by davehorton</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">drachtio-fsmrf</h1>
      <h2 class="project-tagline">drachtio media resource function</h2>
      <a href="https://github.com/davehorton/drachtio-fsmrf" class="btn">View on GitHub</a>
      <a href="https://github.com/davehorton/drachtio-fsmrf/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/davehorton/drachtio-fsmrf/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <div class="drachtio-img"><img src="http://davehorton.github.io/drachtio-fsmrf/img/definition-only-cropped.png">
      </div>
      <p>
        Welcome to the drachtio media resouree function, empowering nodejs/javascript developers to build rich media application on SIP / VoIP networks
      </p>
      <p>drachtio is an open-source, nodejs-based ecosystem for creating any kind of VoIP server-based application: registrar, proxy, back-to-back user agent, and many others. Within the drachtio ecosystem, drachtio-fsmrf is a high-level media processing abstraction layer  that utilizes freeswitch as a media server and partners with the <a href="https://github.com/davehorton/drachtio-srf">drachtio signaling resource framework</a> to enable the creation of media-processing applications such as conferencing, IVR and others.
      </p>

      <p><strong>Note:</strong> API documentation for drachtio-srf <a href="http://davehorton.github.io/drachtio-srf/api/index.html">can be found here</a>.

      <pre>
var app = require('drachtio')() ;
var Mrf = require('drachtio-fsmrf') ;
var mrf = new Mrf(app) ;
var Srf = require('drachtio-srf') ;
var srf = new Srf(app) ;
var ms  ;

srf.connect({...}) ;
mrf.connect({...}, function(mediaServer) {ms = mediaServer;}) ;

srf.invite( function(req, res) {
  
  // connect caller to an enpoint on the media server
  ms.connectCaller(req, res, function(err, ep, dialog) {
    if( err ) thrown err ;

    // set up dialog handlers
    dialog.on('destroy', onCallerHangup.bind(dialog, ep)) ;

    ep.play(['ivr/8000/ivr-please_reenter_your_pin.wav',
      'ivr/8000/ivr-please_state_your_name_and_reason_for_calling.wav',
      'ivr/8000/ivr-you_lose.wav'], function(err, results){
        console.log('results: ', results) ;
      }) ;
  }) ; 
}) ;

function onCallerHangup( ep ) {
  // release endpoint
  ep.destroy() ;
}</pre>
  
  </body>
</html>
